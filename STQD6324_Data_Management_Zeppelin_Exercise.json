{"paragraphs":[{"text":"%md\n\nHands on: Playing with Movielens using Zeppelin\n### Let's make sure Spark is working first! Let's see what version we're working with.","user":"anonymous","dateUpdated":"2025-05-29T02:45:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Hands on: Playing with Movielens using Zeppelin</p>\n<h3>Let's make sure Spark is working first! Let's see what version we're working with.</h3>\n"}]},"apps":[],"jobName":"paragraph_1748485405526_-789600700","id":"20250529-022325_477233170","dateCreated":"2025-05-29T02:23:25+0000","dateStarted":"2025-05-29T02:43:46+0000","dateFinished":"2025-05-29T02:43:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:12585"},{"text":"sc.version\n","user":"anonymous","dateUpdated":"2025-05-29T03:32:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res1: String = 2.3.0.2.6.5.0-292\n"}]},"apps":[],"jobName":"paragraph_1748485485613_-1249620822","id":"20250529-022445_1041787045","dateCreated":"2025-05-29T02:24:45+0000","dateStarted":"2025-05-29T03:32:22+0000","dateFinished":"2025-05-29T03:32:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12586"},{"text":"%sh\r\n\r\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.data -O /tmp/u.data\r\nwget http://media.sundog-soft.com/hadoop/ml-100k/u.item -O /tmp/u.item\r\necho \"Downloaded!\"","user":"anonymous","dateUpdated":"2025-05-29T03:32:24+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2025-05-29 03:32:24--  http://media.sundog-soft.com/hadoop/ml-100k/u.data\nResolving media.sundog-soft.com (media.sundog-soft.com)... 3.5.0.110, 3.5.0.84, 3.5.22.170, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|3.5.0.110|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2079229 (2.0M) [application/octet-stream]\nSaving to: ‘/tmp/u.data\\r’\n\n     0K .......... .......... .......... .......... ..........  2% 68.9K 29s\n    50K .......... .......... .......... .......... ..........  4%  174K 20s\n   100K .......... .......... .......... .......... ..........  7% 6.42M 13s\n   150K .......... .......... .......... .......... ..........  9%  154K 12s\n   200K .......... .......... .......... .......... .......... 12% 8.40M 10s\n   250K .......... .......... .......... .......... .......... 14% 13.1M 8s\n   300K .......... .......... .......... .......... .......... 17% 10.4M 7s\n   350K .......... .......... .......... .......... .......... 19%  173K 7s\n   400K .......... .......... .......... .......... .......... 22% 5.05M 6s\n   450K .......... .......... .......... .......... .......... 24% 11.4M 5s\n   500K .......... .......... .......... .......... .......... 27% 10.8M 4s\n   550K .......... .......... .......... .......... .......... 29% 64.1M 4s\n   600K .......... .......... .......... .......... .......... 32%  173K 4s\n   650K .......... .......... .......... .......... .......... 34% 13.1M 4s\n   700K .......... .......... .......... .......... .......... 36% 14.7M 3s\n   750K .......... .......... .......... .......... .......... 39% 13.9M 3s\n   800K .......... .......... .......... .......... .......... 41% 16.6M 3s\n   850K .......... .......... .......... .......... .......... 44%  174K 3s\n   900K .......... .......... .......... .......... .......... 46% 15.9M 3s\n   950K .......... .......... .......... .......... .......... 49% 4.05M 2s\n  1000K .......... .......... .......... .......... .......... 51% 69.9M 2s\n  1050K .......... .......... .......... .......... .......... 54% 18.0M 2s\n  1100K .......... .......... .......... .......... .......... 56% 26.5M 2s\n  1150K .......... .......... .......... .......... .......... 59% 26.9M 2s\n  1200K .......... .......... .......... .......... .......... 61% 50.8M 1s\n  1250K .......... .......... .......... .......... .......... 64% 9.30M 1s\n  1300K .......... .......... .......... .......... .......... 66% 74.8M 1s\n  1350K .......... .......... .......... .......... .......... 68% 24.1M 1s\n  1400K .......... .......... .......... .......... .......... 71%  174K 1s\n  1450K .......... .......... .......... .......... .......... 73% 9.22M 1s\n  1500K .......... .......... .......... .......... .......... 76% 39.8M 1s\n  1550K .......... .......... .......... .......... .......... 78% 17.3M 1s\n  1600K .......... .......... .......... .......... .......... 81% 30.0M 1s\n  1650K .......... .......... .......... .......... .......... 83% 17.9M 1s\n  1700K .......... .......... .......... .......... .......... 86% 55.1M 0s\n  1750K .......... .......... .......... .......... .......... 88% 33.9M 0s\n  1800K .......... .......... .......... .......... .......... 91% 26.8M 0s\n  1850K .......... .......... .......... .......... .......... 93% 25.0M 0s\n  1900K .......... .......... .......... .......... .......... 96% 49.5M 0s\n  1950K .......... .......... .......... .......... .......... 98% 37.4M 0s\n  2000K .......... .......... ..........                      100% 25.9M=2.6s\n\n2025-05-29 03:32:27 (781 KB/s) - ‘/tmp/u.data\\r’ saved [2079229/2079229]\n\n--2025-05-29 03:32:27--  http://media.sundog-soft.com/hadoop/ml-100k/u.item\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.217.33.196, 16.15.176.88, 3.5.30.110, ...\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.217.33.196|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 236344 (231K) [application/octet-stream]\nSaving to: ‘/tmp/u.item\\r’\n\n     0K .......... .......... .......... .......... .......... 21% 93.1K 2s\n    50K .......... .......... .......... .......... .......... 43%  161K 1s\n   100K .......... .......... .......... .......... .......... 64% 15.3M 0s\n   150K .......... .......... .......... .......... .......... 86%  166K 0s\n   200K .......... .......... ..........                      100% 30.7M=1.2s\n\n2025-05-29 03:32:29 (200 KB/s) - ‘/tmp/u.item\\r’ saved [236344/236344]\n\nDownloaded!\n"}]},"apps":[],"jobName":"paragraph_1748485500605_107034448","id":"20250529-022500_1111314445","dateCreated":"2025-05-29T02:25:00+0000","dateStarted":"2025-05-29T03:32:24+0000","dateFinished":"2025-05-29T03:32:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12587"},{"text":"%sh\nmv \"/tmp/u.data\"$'\\r' /tmp/u.data\nmv \"/tmp/u.item\"$'\\r' /tmp/u.item\n","user":"anonymous","dateUpdated":"2025-05-29T03:32:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1748489378811_-868694588","id":"20250529-032938_686140037","dateCreated":"2025-05-29T03:29:38+0000","dateStarted":"2025-05-29T03:32:35+0000","dateFinished":"2025-05-29T03:32:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12588"},{"text":"%sh\r\nhadoop fs -rm -r -f /tmp/ml-100k","user":"anonymous","dateUpdated":"2025-05-29T03:33:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"25/05/29 03:33:21 INFO fs.TrashPolicyDefault: Moved: 'hdfs://sandbox-hdp.hortonworks.com:8020/tmp/ml-100k' to trash at: hdfs://sandbox-hdp.hortonworks.com:8020/user/zeppelin/.Trash/Current/tmp/ml-100k\n"}]},"apps":[],"jobName":"paragraph_1748485661986_-1123194965","id":"20250529-022741_1158994569","dateCreated":"2025-05-29T02:27:41+0000","dateStarted":"2025-05-29T03:33:19+0000","dateFinished":"2025-05-29T03:33:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12589"},{"text":"%sh\n\nhadoop fs -mkdir /tmp/ml-100k\n","user":"anonymous","dateUpdated":"2025-05-29T03:33:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1748489604010_-484008629","id":"20250529-033324_1084416536","dateCreated":"2025-05-29T03:33:24+0000","dateStarted":"2025-05-29T03:33:31+0000","dateFinished":"2025-05-29T03:33:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12590"},{"text":"%sh\r\n\r\nhadoop fs -put /tmp/u.data /tmp/ml-100k/\r\nhadoop fs -put /tmp/u.item /tmp/ml-100k/","user":"anonymous","dateUpdated":"2025-05-29T03:33:36+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1748486952821_-686666428","id":"20250529-024912_485012367","dateCreated":"2025-05-29T02:49:12+0000","dateStarted":"2025-05-29T03:33:37+0000","dateFinished":"2025-05-29T03:33:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12591"},{"text":"// Define the Rating case class\r\nfinal case class Rating(movieID: Int, rating: Int)\r\n\r\n// Define the Movie case class\r\nfinal case class Movie(movieID: Int, title: String)","user":"anonymous","dateUpdated":"2025-05-29T03:56:22+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one unchecked warning; re-run with -unchecked for details\ndefined class Rating\nwarning: there was one unchecked warning; re-run with -unchecked for details\ndefined class Movie\n"}]},"apps":[],"jobName":"paragraph_1748490906543_-1728830617","id":"20250529-035506_2090928640","dateCreated":"2025-05-29T03:55:06+0000","dateStarted":"2025-05-29T03:56:22+0000","dateFinished":"2025-05-29T03:57:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12592"},{"text":"// Load the u.data file and extract the 2nd and 3rd fields\r\nval lines = sc.textFile(\"hdfs:///tmp/ml-100k/u.data\")\r\n  .map(x => {\r\n    val fields = x.split(\"\\t\") // Split by tab\r\n    Rating(fields(1).toInt, fields(2).toInt) // Extract fields\r\n  })\r\n\r\n// Import implicits for DataFrame support\r\nimport sqlContext.implicits._\r\n\r\n// Create a Spark DataFrame from the RDD\r\nval ratingsDF = lines.toDF()\r\n\r\n// Print the schema of the DataFrame\r\nratingsDF.printSchema()","user":"anonymous","dateUpdated":"2025-05-29T03:57:11+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"lines: org.apache.spark.rdd.RDD[Rating] = MapPartitionsRDD[2] at map at <console>:29\nimport sqlContext.implicits._\nratingsDF: org.apache.spark.sql.DataFrame = [movieID: int, rating: int]\nroot\n |-- movieID: integer (nullable = false)\n |-- rating: integer (nullable = false)\n\n"}]},"apps":[],"jobName":"paragraph_1748490982910_-1677534776","id":"20250529-035622_1047140328","dateCreated":"2025-05-29T03:56:22+0000","dateStarted":"2025-05-29T03:57:12+0000","dateFinished":"2025-05-29T03:57:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12593"},{"text":"// Get top movie IDs by counting ratings\r\nval topMovieIDs = ratingsDF.groupBy(\"movieID\")\r\n  .count()\r\n  .orderBy(desc(\"count\"))\r\n  .cache()\r\n\r\ntopMovieIDs.show()","user":"anonymous","dateUpdated":"2025-05-29T03:57:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"topMovieIDs: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [movieID: int, count: bigint]\n+-------+-----+\n|movieID|count|\n+-------+-----+\n|     50|  583|\n|    258|  509|\n|    100|  508|\n|    181|  507|\n|    294|  485|\n|    286|  481|\n|    288|  478|\n|      1|  452|\n|    300|  431|\n|    121|  429|\n|    174|  420|\n|    127|  413|\n|     56|  394|\n|      7|  392|\n|     98|  390|\n|    237|  384|\n|    117|  378|\n|    172|  367|\n|    222|  365|\n|    204|  350|\n+-------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1748491031421_1033867344","id":"20250529-035711_1590553985","dateCreated":"2025-05-29T03:57:11+0000","dateStarted":"2025-05-29T03:57:23+0000","dateFinished":"2025-05-29T03:57:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12594"},{"text":"// Create a temporary SQL table from the DataFrame\r\nratingsDF.createOrReplaceTempView(\"ratings\")","user":"anonymous","dateUpdated":"2025-05-29T03:58:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1748491043759_268981074","id":"20250529-035723_119338953","dateCreated":"2025-05-29T03:57:23+0000","dateStarted":"2025-05-29T03:58:14+0000","dateFinished":"2025-05-29T03:58:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12595"},{"text":"%sql\r\nSELECT * FROM ratings LIMIT 10","user":"anonymous","dateUpdated":"2025-05-29T03:58:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"movieID\trating\n242\t3\n302\t3\n377\t1\n51\t2\n346\t1\n474\t4\n265\t2\n465\t5\n451\t3\n86\t3\n"}]},"apps":[],"jobName":"paragraph_1748491094157_-564323747","id":"20250529-035814_26420425","dateCreated":"2025-05-29T03:58:14+0000","dateStarted":"2025-05-29T03:58:21+0000","dateFinished":"2025-05-29T03:58:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12596"},{"text":"%sql\r\nSELECT rating, COUNT(*) AS count FROM ratings GROUP BY rating","user":"anonymous","dateUpdated":"2025-05-29T03:58:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"rating\tcount\n1\t6110\n3\t27145\n5\t21201\n4\t34174\n2\t11370\n"}]},"apps":[],"jobName":"paragraph_1748491100724_-458117727","id":"20250529-035820_1715407003","dateCreated":"2025-05-29T03:58:20+0000","dateStarted":"2025-05-29T03:58:33+0000","dateFinished":"2025-05-29T03:58:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12597"},{"text":"// Load the u.item file and extract movie IDs and titles\r\nval movieLines = sc.textFile(\"hdfs:///tmp/ml-100k/u.item\")\r\n  .map(x => {\r\n    val fields = x.split(\"\\\\|\") // Split by pipe\r\n    Movie(fields(0).toInt, fields(1)) // Extract fields\r\n  })\r\n\r\n// Create a DataFrame for movies\r\nval moviesDF = movieLines.toDF()\r\n\r\n// Show the movies DataFrame\r\nmoviesDF.show()\r\n\r\n// Create a temporary SQL table for titles\r\nmoviesDF.createOrReplaceTempView(\"titles\")","user":"anonymous","dateUpdated":"2025-05-29T03:59:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"movieLines: org.apache.spark.rdd.RDD[Movie] = MapPartitionsRDD[45] at map at <console>:34\nmoviesDF: org.apache.spark.sql.DataFrame = [movieID: int, title: string]\n+-------+--------------------+\n|movieID|               title|\n+-------+--------------------+\n|      1|    Toy Story (1995)|\n|      2|    GoldenEye (1995)|\n|      3|   Four Rooms (1995)|\n|      4|   Get Shorty (1995)|\n|      5|      Copycat (1995)|\n|      6|Shanghai Triad (Y...|\n|      7|Twelve Monkeys (1...|\n|      8|         Babe (1995)|\n|      9|Dead Man Walking ...|\n|     10|  Richard III (1995)|\n|     11|Seven (Se7en) (1995)|\n|     12|Usual Suspects, T...|\n|     13|Mighty Aphrodite ...|\n|     14|  Postino, Il (1994)|\n|     15|Mr. Holland's Opu...|\n|     16|French Twist (Gaz...|\n|     17|From Dusk Till Da...|\n|     18|White Balloon, Th...|\n|     19|Antonia's Line (1...|\n|     20|Angels and Insect...|\n+-------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1748491113682_993371307","id":"20250529-035833_213034403","dateCreated":"2025-05-29T03:58:33+0000","dateStarted":"2025-05-29T03:59:05+0000","dateFinished":"2025-05-29T03:59:06+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12598"},{"text":"%sql\nSELECT t.title, COUNT(*) AS cnt \nFROM ratings r \nJOIN titles t ON r.movieID = t.movieID \nGROUP BY t.title \nORDER BY cnt DESC \nLIMIT 20\n","user":"anonymous","dateUpdated":"2025-05-29T03:59:11+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"title\tcnt\nStar Wars (1977)\t583\nContact (1997)\t509\nFargo (1996)\t508\nReturn of the Jedi (1983)\t507\nLiar Liar (1997)\t485\nEnglish Patient, The (1996)\t481\nScream (1996)\t478\nToy Story (1995)\t452\nAir Force One (1997)\t431\nIndependence Day (ID4) (1996)\t429\nRaiders of the Lost Ark (1981)\t420\nGodfather, The (1972)\t413\nPulp Fiction (1994)\t394\nTwelve Monkeys (1995)\t392\nSilence of the Lambs, The (1991)\t390\nJerry Maguire (1996)\t384\nChasing Amy (1997)\t379\nRock, The (1996)\t378\nEmpire Strikes Back, The (1980)\t367\nStar Trek: First Contact (1996)\t365\n"}]},"apps":[],"jobName":"paragraph_1748491128629_-1941477978","id":"20250529-035848_223747686","dateCreated":"2025-05-29T03:58:48+0000","dateStarted":"2025-05-29T03:59:12+0000","dateFinished":"2025-05-29T03:59:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:12599"},{"text":"\n","user":"anonymous","dateUpdated":"2025-05-29T04:00:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1748491151838_2113821401","id":"20250529-035911_874988326","dateCreated":"2025-05-29T03:59:11+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:12600"}],"name":"STQD6324_Data_Management_Zeppelin_Exercise","id":"2KVGC1T6S","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}